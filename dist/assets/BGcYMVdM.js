import{P as B,bT as T,bG as v,a7 as N,bV as x,ch as k,ce as P,d_ as $,cg as b,d$ as F,$ as _,e0 as R,a6 as L,e1 as O,bv as A,ca as H,c7 as z,e2 as W,c5 as S,c0 as j,b$ as C,a8 as E,cL as D,e3 as U,e4 as V,e5 as q,cB as G,e6 as K,e7 as J}from"./D5Je1u5Y.js";function ne(s,e){if(s.length!==e.length)throw new B({expectedLength:s.length,givenLength:e.length});const i=[];for(let r=0;r<s.length;r++){const l=s[r],o=e[r];i.push(I(l,o))}return T(i)}function I(s,e,i=!1){if(s==="address"){const a=e;if(!v(a))throw new N({address:a});return x(a.toLowerCase(),{size:i?32:null})}if(s==="string")return k(e);if(s==="bytes")return e;if(s==="bool")return x(P(e),{size:i?32:1});const r=s.match($);if(r){const[a,n,c="256"]=r,u=Number.parseInt(c,10)/8;return b(e,{size:i?32:u,signed:n==="int"})}const l=s.match(F);if(l){const[a,n]=l;if(Number.parseInt(n,10)!==(e.length-2)/2)throw new _({expectedSize:Number.parseInt(n,10),givenSize:(e.length-2)/2});return x(e,{dir:"right",size:i?32:null})}const o=s.match(R);if(o&&Array.isArray(e)){const[a,n]=o,c=[];for(let u=0;u<e.length;u++)c.push(I(n,e[u],!0));return c.length===0?"0x":T(c)}throw new L(s)}function re(s){const{source:e}=s,i=new Map,r=new O(8192),l=new Map,o=({address:a,chainId:n})=>`${a}.${n}`;return{async consume({address:a,chainId:n,client:c}){const u=o({address:a,chainId:n}),t=this.get({address:a,chainId:n,client:c});this.increment({address:a,chainId:n});const h=await t;return await e.set({address:a,chainId:n},h),r.set(u,h),h},async increment({address:a,chainId:n}){const c=o({address:a,chainId:n}),u=i.get(c)??0;i.set(c,u+1)},async get({address:a,chainId:n,client:c}){const u=o({address:a,chainId:n});let t=l.get(u);return t||(t=(async()=>{try{const m=await e.get({address:a,chainId:n,client:c}),f=r.get(u)??0;return f>0&&m<=f?f+1:(r.delete(u),m)}finally{this.reset({address:a,chainId:n})}})(),l.set(u,t)),(i.get(u)??0)+await t},reset({address:a,chainId:n}){const c=o({address:a,chainId:n});i.delete(c),l.delete(c)}}}const Q="0x6492649264926492649264926492649264926492649264926492649264926492";function ae(s){const{address:e,data:i,signature:r,to:l="hex"}=s,o=T([A([{type:"address"},{type:"bytes"},{type:"bytes"}],[e,i,r]),Q]);return l==="hex"?o:H(o)}const X="0x5792579257925792579257925792579257925792579257925792579257925792",Y=b(0,{size:32});async function Z(s,e){async function i(t){if(t.endsWith(X.slice(2))){const m=j(C(t,-64,-32)),f=C(t,0,-64).slice(2).match(/.{1,64}/g),p=await Promise.all(f.map(d=>Y.slice(2)!==d?s.request({method:"eth_getTransactionReceipt",params:[`0x${d}`]},{dedupe:!0}):void 0)),g=p.some(d=>d===null)?100:p.every(d=>(d==null?void 0:d.status)==="0x1")?200:p.every(d=>(d==null?void 0:d.status)==="0x0")?500:600;return{atomic:!1,chainId:z(m),receipts:p.filter(Boolean),status:g,version:"2.0.0"}}return s.request({method:"wallet_getCallsStatus",params:[t]})}const{atomic:r=!1,chainId:l,receipts:o,version:a="2.0.0",...n}=await i(e.id),[c,u]=(()=>{const t=n.status;return t>=100&&t<200?["pending",t]:t>=200&&t<300?["success",t]:t>=300&&t<700?["failure",t]:t==="CONFIRMED"?["success",200]:t==="PENDING"?["pending",100]:[void 0,t]})();return{...n,atomic:r,chainId:l?z(l):void 0,receipts:(o==null?void 0:o.map(t=>({...t,blockNumber:S(t.blockNumber),gasUsed:S(t.gasUsed),status:W[t.status]})))??[],statusCode:u,status:c,version:a}}class ee extends E{constructor(e){super(`Call bundle failed with status: ${e.statusCode}`,{name:"BundleFailedError"}),Object.defineProperty(this,"result",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.result=e}}async function ie(s,e){const{id:i,pollingInterval:r=s.pollingInterval,status:l=({statusCode:g})=>g===200||g>=300,retryCount:o=4,retryDelay:a=({count:g})=>~~(1<<g)*200,timeout:n=6e4,throwOnFailure:c=!1}=e,u=D(["waitForCallsStatus",s.uid,i]),{promise:t,resolve:h,reject:m}=U();let f;const p=V(u,{resolve:h,reject:m},g=>{const d=q(async()=>{const M=y=>{clearTimeout(f),d(),y(),p()};try{const y=await G(async()=>{const w=await K(s,Z,"getCallsStatus")({id:i});if(c&&w.status==="failure")throw new ee(w);return w},{retryCount:o,delay:a});if(!l(y))return;M(()=>g.resolve(y))}catch(y){M(()=>g.reject(y))}},{interval:r,emitOnBegin:!0});return d});return f=n?setTimeout(()=>{p(),clearTimeout(f),m(new te({id:i}))},n):void 0,await t}class te extends E{constructor({id:e}){super(`Timed out while waiting for call bundle with id "${e}" to be confirmed.`,{name:"WaitForCallsStatusTimeoutError"})}}function oe(s){const{r:e,s:i}=J.Signature.fromCompact(s.slice(2,130)),r=+`0x${s.slice(130)}`,[l,o]=(()=>{if(r===0||r===1)return[void 0,r];if(r===27)return[BigInt(r),0];if(r===28)return[BigInt(r),1];throw new Error("Invalid yParityOrV value")})();return typeof l<"u"?{r:b(e,{size:32}),s:b(i,{size:32}),v:l,yParity:o}:{r:b(e,{size:32}),s:b(i,{size:32}),yParity:o}}export{ee as B,te as W,re as c,ne as e,oe as p,ae as s,ie as w};
